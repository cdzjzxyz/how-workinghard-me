{"ast":null,"code":"import axios from 'axios';\nimport { ref, reactive, onMounted, computed } from 'vue';\nimport { ElMessageBox, ElMessage } from 'element-plus';\nimport dayjs from 'dayjs';\nconst BASE_URL = 'http://localhost:8080';\nexport default {\n  name: 'DepartmentManage',\n  setup() {\n    const isAdmin = computed(() => {\n      const user = localStorage.getItem('user') ? JSON.parse(localStorage.getItem('user')) : {};\n      return user && user.username === 'admin';\n    });\n    const deptList = ref([]);\n    const loading = ref(false);\n    const dialogVisible = ref(false);\n    const dialogTitle = ref('');\n    const form = reactive({\n      id: null,\n      name: ''\n    });\n    const formRef = ref(null);\n    const rules = {\n      name: [{\n        required: true,\n        message: '请输入部门名称',\n        trigger: 'blur'\n      }, {\n        min: 2,\n        max: 10,\n        message: '长度为2-10位',\n        trigger: 'blur'\n      }]\n    };\n    const isEdit = ref(false);\n\n    // 时间格式化\n    const formatDate = val => {\n      if (!val) return '';\n      if (Array.isArray(val)) {\n        return dayjs(new Date(val[0], val[1] - 1, val[2], val[3] || 0, val[4] || 0, val[5] || 0)).format('YYYY-MM-DD HH:mm:ss');\n      }\n      return dayjs(val).isValid() ? dayjs(val).format('YYYY-MM-DD HH:mm:ss') : val;\n    };\n\n    // 查询部门列表\n    const fetchDepts = async () => {\n      loading.value = true;\n      try {\n        const res = await axios.get(`${BASE_URL}/depts`);\n        if (res.data.code === 1) {\n          deptList.value = res.data.data;\n        }\n      } finally {\n        loading.value = false;\n      }\n    };\n\n    // 打开新增弹窗\n    const openAddDialog = () => {\n      dialogTitle.value = '新增部门';\n      form.id = null;\n      form.name = '';\n      isEdit.value = false;\n      dialogVisible.value = true;\n    };\n\n    // 打开编辑弹窗\n    const openEditDialog = async row => {\n      dialogTitle.value = '编辑部门';\n      isEdit.value = true;\n      const res = await axios.get(`${BASE_URL}/depts/${row.id}`);\n      if (res.data.code === 1) {\n        form.id = res.data.data.id;\n        form.name = res.data.data.name;\n        dialogVisible.value = true;\n      }\n    };\n\n    // 提交表单\n    const handleSubmit = () => {\n      formRef.value.validate(async valid => {\n        if (!valid) return;\n        if (isEdit.value) {\n          await axios.put(`${BASE_URL}/depts`, {\n            id: form.id,\n            name: form.name\n          });\n          ElMessage.success('修改成功');\n        } else {\n          await axios.post(`${BASE_URL}/depts`, {\n            name: form.name\n          });\n          ElMessage.success('新增成功');\n        }\n        dialogVisible.value = false;\n        fetchDepts();\n      });\n    };\n\n    // 删除部门，带二次确认\n    const handleDelete = id => {\n      ElMessageBox.confirm('确定要删除该部门吗？', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(async () => {\n        await axios.delete(`${BASE_URL}/depts/${id}`);\n        ElMessage.success('删除成功');\n        fetchDepts();\n      }).catch(() => {});\n    };\n    onMounted(() => {\n      fetchDepts();\n    });\n    return {\n      isAdmin,\n      deptList,\n      loading,\n      dialogVisible,\n      dialogTitle,\n      form,\n      formRef,\n      rules,\n      isEdit,\n      openAddDialog,\n      openEditDialog,\n      handleSubmit,\n      handleDelete,\n      formatDate\n    };\n  }\n};","map":{"version":3,"names":["axios","ref","reactive","onMounted","computed","ElMessageBox","ElMessage","dayjs","BASE_URL","name","setup","isAdmin","user","localStorage","getItem","JSON","parse","username","deptList","loading","dialogVisible","dialogTitle","form","id","formRef","rules","required","message","trigger","min","max","isEdit","formatDate","val","Array","isArray","Date","format","isValid","fetchDepts","value","res","get","data","code","openAddDialog","openEditDialog","row","handleSubmit","validate","valid","put","success","post","handleDelete","confirm","confirmButtonText","cancelButtonText","type","then","delete","catch"],"sources":["D:\\web_code\\zxyf\\test_vue\\src\\components\\Dept.vue"],"sourcesContent":["<template>\n  <div>\n    <el-card>\n      <div style=\"display: flex; align-items: center; border-bottom: 2px solid #1890ff; margin-bottom: 0;\">\n        <span style=\"font-size: 20px; font-weight: bold; color: #1890ff; border-bottom: 2px solid #1890ff; padding: 0 16px 8px 0;\">部门管理</span>\n        <el-button v-if=\"isAdmin\" type=\"primary\" @click=\"openAddDialog\" style=\"margin-left: 24px; margin-bottom: 8px;\">+ 新增部门</el-button>\n      </div>\n      <el-table :data=\"deptList\" style=\"width: 100%; margin-top: 16px;\" v-loading=\"loading\" border>\n        <el-table-column label=\"序号\" type=\"index\" width=\"60\" align=\"center\" />\n        <el-table-column prop=\"name\" label=\"部门名称\" align=\"center\" />\n        <el-table-column prop=\"updateTime\" label=\"最后操作时间\" align=\"center\">\n          <template #default=\"scope\">\n            {{ formatDate(scope.row.updateTime) }}\n          </template>\n        </el-table-column>\n        <el-table-column label=\"操作\" width=\"120\" align=\"center\" v-if=\"isAdmin\">\n          <template #default=\"scope\">\n            <span class=\"action-link\" @click=\"openEditDialog(scope.row)\">编辑</span>\n            <span class=\"action-link\" style=\"margin-left: 12px;\" @click=\"handleDelete(scope.row.id)\">删除</span>\n          </template>\n        </el-table-column>\n      </el-table>\n    </el-card>\n\n    <!-- 新增/编辑部门弹窗 -->\n    <el-dialog :title=\"dialogTitle\" v-model=\"dialogVisible\" width=\"400px\">\n      <el-form :model=\"form\" :rules=\"rules\" ref=\"formRef\" label-width=\"80px\">\n        <el-form-item label=\"部门名称\" prop=\"name\">\n          <el-input v-model=\"form.name\" autocomplete=\"off\" placeholder=\"请输入部门名称，长度为2-10位\" maxlength=\"10\" />\n        </el-form-item>\n      </el-form>\n      <template #footer>\n        <el-button @click=\"dialogVisible = false\">取消</el-button>\n        <el-button type=\"primary\" @click=\"handleSubmit\">{{ isEdit ? '保存' : '新增' }}</el-button>\n      </template>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios'\nimport { ref, reactive, onMounted, computed } from 'vue'\nimport { ElMessageBox, ElMessage } from 'element-plus'\nimport dayjs from 'dayjs'\n\nconst BASE_URL = 'http://localhost:8080'\n\nexport default {\n  name: 'DepartmentManage',\n  setup() {\n    const isAdmin = computed(() => {\n      const user = localStorage.getItem('user') ? JSON.parse(localStorage.getItem('user')) : {}\n      return user && user.username === 'admin'\n    })\n    const deptList = ref([])\n    const loading = ref(false)\n    const dialogVisible = ref(false)\n    const dialogTitle = ref('')\n    const form = reactive({ id: null, name: '' })\n    const formRef = ref(null)\n    const rules = {\n      name: [\n        { required: true, message: '请输入部门名称', trigger: 'blur' },\n        { min: 2, max: 10, message: '长度为2-10位', trigger: 'blur' }\n      ]\n    }\n    const isEdit = ref(false)\n\n    // 时间格式化\n    const formatDate = (val) => {\n      if (!val) return ''\n      if (Array.isArray(val)) {\n        return dayjs(new Date(\n          val[0], val[1] - 1, val[2], val[3] || 0, val[4] || 0, val[5] || 0\n        )).format('YYYY-MM-DD HH:mm:ss')\n      }\n      return dayjs(val).isValid() ? dayjs(val).format('YYYY-MM-DD HH:mm:ss') : val\n    }\n\n    // 查询部门列表\n    const fetchDepts = async () => {\n      loading.value = true\n      try {\n        const res = await axios.get(`${BASE_URL}/depts`)\n        if (res.data.code === 1) {\n          deptList.value = res.data.data\n        }\n      } finally {\n        loading.value = false\n      }\n    }\n\n    // 打开新增弹窗\n    const openAddDialog = () => {\n      dialogTitle.value = '新增部门'\n      form.id = null\n      form.name = ''\n      isEdit.value = false\n      dialogVisible.value = true\n    }\n\n    // 打开编辑弹窗\n    const openEditDialog = async (row) => {\n      dialogTitle.value = '编辑部门'\n      isEdit.value = true\n      const res = await axios.get(`${BASE_URL}/depts/${row.id}`)\n      if (res.data.code === 1) {\n        form.id = res.data.data.id\n        form.name = res.data.data.name\n        dialogVisible.value = true\n      }\n    }\n\n    // 提交表单\n    const handleSubmit = () => {\n      formRef.value.validate(async (valid) => {\n        if (!valid) return\n        if (isEdit.value) {\n          await axios.put(`${BASE_URL}/depts`, { id: form.id, name: form.name })\n          ElMessage.success('修改成功')\n        } else {\n          await axios.post(`${BASE_URL}/depts`, { name: form.name })\n          ElMessage.success('新增成功')\n        }\n        dialogVisible.value = false\n        fetchDepts()\n      })\n    }\n\n    // 删除部门，带二次确认\n    const handleDelete = (id) => {\n      ElMessageBox.confirm('确定要删除该部门吗？', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning',\n      }).then(async () => {\n        await axios.delete(`${BASE_URL}/depts/${id}`)\n        ElMessage.success('删除成功')\n        fetchDepts()\n      }).catch(() => {})\n    }\n\n    onMounted(() => {\n      fetchDepts()\n    })\n\n    return {\n      isAdmin,\n      deptList,\n      loading,\n      dialogVisible,\n      dialogTitle,\n      form,\n      formRef,\n      rules,\n      isEdit,\n      openAddDialog,\n      openEditDialog,\n      handleSubmit,\n      handleDelete,\n      formatDate\n    }\n  }\n}\n</script>\n\n<style scoped>\n.el-card {\n  border-radius: 12px;\n  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);\n  padding: 20px;\n  background-color: #f9fcff;\n}\n\n.action-link {\n  color: #faad14;\n  cursor: pointer;\n  font-size: 15px;\n  transition: color 0.2s;\n}\n.action-link:hover {\n  color: #ff6700;\n  text-decoration: underline;\n}\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}