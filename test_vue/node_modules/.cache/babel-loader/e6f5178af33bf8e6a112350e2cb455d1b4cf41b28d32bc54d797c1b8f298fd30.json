{"ast":null,"code":"import { ref, onMounted } from 'vue';\nimport axios from 'axios';\nimport { ElMessage } from 'element-plus';\nexport default {\n  __name: 'AttendanceReport',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const month = ref(new Date().toISOString().slice(0, 7));\n    const report = ref({\n      attend: 0,\n      late: 0,\n      early: 0,\n      absent: 0,\n      leave: 0\n    });\n    const detailList = ref([]);\n    const monthScore = ref(null);\n    const fetchReport = async () => {\n      // 假设后端接口 /attendance/report?month=YYYY-MM\n      const {\n        data\n      } = await axios.get('/attendance/report', {\n        params: {\n          month: month.value\n        }\n      });\n      if (data.code === 1) {\n        report.value = data.data.summary;\n        detailList.value = data.data.detail;\n        fetchMonthScore();\n      } else {\n        ElMessage.error(data.msg || '获取报表失败');\n      }\n    };\n    const fetchMonthScore = async () => {\n      const {\n        data\n      } = await axios.get('/attendance/month-score', {\n        params: {\n          month: month.value\n        }\n      });\n      if (data.code === 1) {\n        monthScore.value = data.data;\n      } else {\n        monthScore.value = null;\n      }\n    };\n    const exportExcel = async () => {\n      try {\n        // 自动带token\n        const token = localStorage.getItem('token');\n        const res = await axios.get('/attendance/export', {\n          params: {\n            month: month.value\n          },\n          responseType: 'blob',\n          headers: token ? {\n            token\n          } : {}\n        });\n        // 处理文件名（兼容中文）\n        let fileName = `考勤报表_${month.value}.xlsx`;\n        const disposition = res.headers && (res.headers['content-disposition'] || res.headers['Content-Disposition']);\n        if (disposition) {\n          const match = disposition.match(/filename\\*=UTF-8''(.+)/);\n          if (match) fileName = decodeURIComponent(match[1]);else {\n            const match2 = disposition.match(/filename=\"?([^\";]+)\"?/);\n            if (match2) fileName = decodeURIComponent(match2[1]);\n          }\n        }\n        const blob = new Blob([res.data], {\n          type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'\n        });\n        const url = window.URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = fileName;\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        window.URL.revokeObjectURL(url);\n      } catch (e) {\n        ElMessage.error('导出失败，请联系管理员！');\n      }\n    };\n    const statusText = status => {\n      switch (status) {\n        case 1:\n          return '正常';\n        case 2:\n          return '迟到';\n        case 3:\n          return '早退';\n        case 4:\n          return '缺卡';\n        case 5:\n          return '请假';\n        default:\n          return '未知';\n      }\n    };\n    const statusClass = status => {\n      switch (status) {\n        case 1:\n          return 'attendance-status-normal';\n        case 2:\n          return 'attendance-status-late';\n        case 3:\n          return 'attendance-status-early';\n        case 4:\n          return 'attendance-status-absent';\n        case 5:\n          return 'attendance-status-leave';\n        default:\n          return '';\n      }\n    };\n    onMounted(() => {\n      fetchReport();\n      fetchMonthScore();\n    });\n    const __returned__ = {\n      month,\n      report,\n      detailList,\n      monthScore,\n      fetchReport,\n      fetchMonthScore,\n      exportExcel,\n      statusText,\n      statusClass,\n      ref,\n      onMounted,\n      get axios() {\n        return axios;\n      },\n      get ElMessage() {\n        return ElMessage;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","axios","ElMessage","month","Date","toISOString","slice","report","attend","late","early","absent","leave","detailList","monthScore","fetchReport","data","get","params","value","code","summary","detail","fetchMonthScore","error","msg","exportExcel","token","localStorage","getItem","res","responseType","headers","fileName","disposition","match","decodeURIComponent","match2","blob","Blob","type","url","window","URL","createObjectURL","a","document","createElement","href","download","body","appendChild","click","removeChild","revokeObjectURL","e","statusText","status","statusClass"],"sources":["D:/web_code/zxyf/test_vue/src/components/AttendanceReport.vue"],"sourcesContent":["<template>\n  <div>\n    <el-form :inline=\"true\" style=\"margin-bottom: 18px;\">\n      <el-form-item label=\"月份\">\n        <el-date-picker v-model=\"month\" type=\"month\" value-format=\"YYYY-MM\" />\n      </el-form-item>\n      <el-form-item>\n        <el-button type=\"primary\" @click=\"fetchReport\">查询</el-button>\n        <el-button @click=\"exportExcel\">导出Excel</el-button>\n      </el-form-item>\n    </el-form>\n    <el-alert v-if=\"monthScore !== null\" :title=\"`本月考勤绩效分：${monthScore}`\" type=\"success\" show-icon style=\"margin-bottom: 18px;\" />\n    <el-row :gutter=\"20\" style=\"margin-bottom: 18px;\">\n      <el-col :span=\"4\"><div class=\"stat-block attend\">出勤：{{ report.attend }}</div></el-col>\n      <el-col :span=\"4\"><div class=\"stat-block late\">迟到：{{ report.late }}</div></el-col>\n      <el-col :span=\"4\"><div class=\"stat-block early\">早退：{{ report.early }}</div></el-col>\n      <el-col :span=\"4\"><div class=\"stat-block absent\">缺卡：{{ report.absent }}</div></el-col>\n      <el-col :span=\"4\"><div class=\"stat-block leave\">请假：{{ report.leave }}</div></el-col>\n    </el-row>\n    <el-table :data=\"detailList\" border stripe style=\"margin-bottom: 18px;\">\n      <el-table-column prop=\"date\" label=\"日期\" width=\"110\" />\n      <el-table-column prop=\"checkIn\" label=\"签到时间\" width=\"120\" />\n      <el-table-column prop=\"checkOut\" label=\"签退时间\" width=\"120\" />\n      <el-table-column prop=\"status\" label=\"状态\" width=\"90\">\n        <template #default=\"scope\">\n          <span :class=\"statusClass(scope.row.status)\">{{ statusText(scope.row.status) }}</span>\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"performanceScore\" label=\"绩效分数\" width=\"100\" />\n    </el-table>\n  </div>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue'\nimport axios from 'axios'\nimport { ElMessage } from 'element-plus'\n\nconst month = ref(new Date().toISOString().slice(0, 7))\nconst report = ref({ attend: 0, late: 0, early: 0, absent: 0, leave: 0 })\nconst detailList = ref([])\nconst monthScore = ref(null)\n\nconst fetchReport = async () => {\n  // 假设后端接口 /attendance/report?month=YYYY-MM\n  const { data } = await axios.get('/attendance/report', { params: { month: month.value } })\n  if (data.code === 1) {\n    report.value = data.data.summary\n    detailList.value = data.data.detail\n    fetchMonthScore()\n  } else {\n    ElMessage.error(data.msg || '获取报表失败')\n  }\n}\nconst fetchMonthScore = async () => {\n  const { data } = await axios.get('/attendance/month-score', { params: { month: month.value } })\n  if (data.code === 1) {\n    monthScore.value = data.data\n  } else {\n    monthScore.value = null\n  }\n}\nconst exportExcel = async () => {\n  try {\n    // 自动带token\n    const token = localStorage.getItem('token')\n    const res = await axios.get('/attendance/export', {\n      params: { month: month.value },\n      responseType: 'blob',\n      headers: token ? { token } : {}\n    })\n    // 处理文件名（兼容中文）\n    let fileName = `考勤报表_${month.value}.xlsx`\n    const disposition = res.headers && (res.headers['content-disposition'] || res.headers['Content-Disposition'])\n    if (disposition) {\n      const match = disposition.match(/filename\\*=UTF-8''(.+)/)\n      if (match) fileName = decodeURIComponent(match[1])\n      else {\n        const match2 = disposition.match(/filename=\"?([^\";]+)\"?/)\n        if (match2) fileName = decodeURIComponent(match2[1])\n      }\n    }\n    const blob = new Blob([res.data], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' })\n    const url = window.URL.createObjectURL(blob)\n    const a = document.createElement('a')\n    a.href = url\n    a.download = fileName\n    document.body.appendChild(a)\n    a.click()\n    document.body.removeChild(a)\n    window.URL.revokeObjectURL(url)\n  } catch (e) {\n    ElMessage.error('导出失败，请联系管理员！')\n  }\n}\nconst statusText = (status) => {\n  switch (status) {\n    case 1: return '正常';\n    case 2: return '迟到';\n    case 3: return '早退';\n    case 4: return '缺卡';\n    case 5: return '请假';\n    default: return '未知';\n  }\n}\nconst statusClass = (status) => {\n  switch (status) {\n    case 1: return 'attendance-status-normal'\n    case 2: return 'attendance-status-late'\n    case 3: return 'attendance-status-early'\n    case 4: return 'attendance-status-absent'\n    case 5: return 'attendance-status-leave'\n    default: return ''\n  }\n}\nonMounted(() => { fetchReport(); fetchMonthScore(); })\n</script>\n\n<style scoped>\n.stat-block {\n  background: linear-gradient(135deg, #e0eafc 60%, #cfdef3 100%);\n  border-radius: 8px;\n  padding: 10px 0;\n  font-size: 15px;\n  text-align: center;\n  margin-bottom: 6px;\n  color: #409EFF;\n  font-weight: bold;\n  box-shadow: 0 1px 4px rgba(64,158,255,0.05);\n}\n.stat-block.attend { background: linear-gradient(135deg, #e8f8ef 60%, #d2f4e5 100%); color: #219150; }\n.stat-block.late { background: linear-gradient(135deg, #fff6e5 60%, #ffe6c7 100%); color: #b26a00; }\n.stat-block.early { background: linear-gradient(135deg, #ffeaea 60%, #ffd6d6 100%); color: #c0392b; }\n.stat-block.absent { background: linear-gradient(135deg, #f4f4f5 60%, #e0e0e0 100%); color: #606266; }\n.stat-block.leave { background: linear-gradient(135deg, #e6f4ff 60%, #c7e6ff 100%); color: #1765ad; }\n.attendance-status-normal { color: #219150; font-weight: bold; }\n.attendance-status-late { color: #b26a00; font-weight: bold; }\n.attendance-status-early { color: #c0392b; font-weight: bold; }\n.attendance-status-absent { color: #606266; font-weight: bold; }\n.attendance-status-leave { color: #1765ad; font-weight: bold; }\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}