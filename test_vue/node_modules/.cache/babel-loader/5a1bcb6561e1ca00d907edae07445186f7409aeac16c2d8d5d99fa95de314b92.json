{"ast":null,"code":"import { ref, onMounted, computed } from 'vue';\nimport axios from 'axios';\nimport { ElMessage, ElMessageBox } from 'element-plus';\nimport dayjs from 'dayjs';\nimport { useRoute } from 'vue-router';\nexport default {\n  __name: 'Announcement',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const announcements = ref([]);\n    const dialogVisible = ref(false);\n    const dialogTitle = ref('');\n    const form = ref({\n      id: null,\n      title: '',\n      content: ''\n    });\n    const isEditing = ref(false);\n    const route = useRoute();\n    const isUpdatePage = computed(() => route.path === '/announcement/update');\n    const latestAnnouncementForm = ref({\n      id: null,\n      title: '',\n      content: ''\n    });\n    const fetchAnnouncements = async () => {\n      try {\n        const res = await axios.get('/announcement');\n        if (res.data.code === 1) {\n          // 格式化时间\n          announcements.value = res.data.data.map(item => ({\n            ...item,\n            createTime: dayjs(item.createTime).format('YYYY-MM-DD HH:mm:ss')\n          }));\n        }\n      } catch (error) {\n        ElMessage.error('获取公告列表失败');\n        console.error(error);\n      }\n    };\n    const fetchLatestAnnouncement = async () => {\n      try {\n        const res = await axios.get('/announcement/latest');\n        if (res.data.code === 1 && res.data.data) {\n          latestAnnouncementForm.value = res.data.data;\n        } else {\n          ElMessage.info('暂无系统公告可更新。');\n          latestAnnouncementForm.value = {\n            id: null,\n            title: '',\n            content: ''\n          };\n        }\n      } catch (error) {\n        ElMessage.error('获取最新公告失败');\n        console.error(error);\n      }\n    };\n    const openDialog = (type, row = null) => {\n      if (type === 'add') {\n        dialogTitle.value = '新增公告';\n        form.value = {\n          id: null,\n          title: '',\n          content: ''\n        };\n        isEditing.value = false;\n      } else {\n        // edit\n        dialogTitle.value = '编辑公告';\n        form.value = {\n          ...row\n        }; // 复制现有数据\n        isEditing.value = true;\n      }\n      dialogVisible.value = true;\n    };\n    const submitForm = async () => {\n      try {\n        let res;\n        if (isEditing.value) {\n          res = await axios.put(`/announcement/${form.value.id}`, form.value);\n        } else {\n          res = await axios.post('/announcement', form.value);\n        }\n        if (res.data.code === 1) {\n          ElMessage.success(`${isEditing.value ? '更新' : '新增'}成功`);\n          dialogVisible.value = false;\n          fetchAnnouncements(); // 刷新列表\n        } else {\n          ElMessage.error(res.data.msg || `${isEditing.value ? '更新' : '新增'}失败`);\n        }\n      } catch (error) {\n        ElMessage.error(`${isEditing.value ? '更新' : '新增'}异常`);\n        console.error(error);\n      }\n    };\n    const submitUpdateForm = async () => {\n      if (!latestAnnouncementForm.value.title || !latestAnnouncementForm.value.content) {\n        ElMessage.warning('标题和内容不能为空');\n        return;\n      }\n      try {\n        const res = await axios.put(`/announcement/${latestAnnouncementForm.value.id}`, latestAnnouncementForm.value);\n        if (res.data.code === 1) {\n          ElMessage.success('系统公告更新成功');\n        } else {\n          ElMessage.error(res.data.msg || '系统公告更新失败');\n        }\n      } catch (error) {\n        ElMessage.error('更新系统公告异常');\n        console.error(error);\n      }\n    };\n    const deleteAnnouncement = async row => {\n      ElMessageBox.confirm(`确定删除公告 \"${row.title}\" 吗?`, '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(async () => {\n        try {\n          const res = await axios.delete(`/announcement/${row.id}`);\n          if (res.data.code === 1) {\n            ElMessage.success('删除成功');\n            fetchAnnouncements(); // 刷新列表\n          } else {\n            ElMessage.error(res.data.msg || '删除失败');\n          }\n        } catch (error) {\n          ElMessage.error('删除异常');\n          console.error(error);\n        }\n      }).catch(() => {\n        ElMessage.info('已取消删除');\n      });\n    };\n    onMounted(() => {\n      if (isUpdatePage.value) {\n        fetchLatestAnnouncement();\n      } else {\n        fetchAnnouncements();\n      }\n    });\n    const __returned__ = {\n      announcements,\n      dialogVisible,\n      dialogTitle,\n      form,\n      isEditing,\n      route,\n      isUpdatePage,\n      latestAnnouncementForm,\n      fetchAnnouncements,\n      fetchLatestAnnouncement,\n      openDialog,\n      submitForm,\n      submitUpdateForm,\n      deleteAnnouncement,\n      ref,\n      onMounted,\n      computed,\n      get axios() {\n        return axios;\n      },\n      get ElMessage() {\n        return ElMessage;\n      },\n      get ElMessageBox() {\n        return ElMessageBox;\n      },\n      get dayjs() {\n        return dayjs;\n      },\n      get useRoute() {\n        return useRoute;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","computed","axios","ElMessage","ElMessageBox","dayjs","useRoute","announcements","dialogVisible","dialogTitle","form","id","title","content","isEditing","route","isUpdatePage","path","latestAnnouncementForm","fetchAnnouncements","res","get","data","code","value","map","item","createTime","format","error","console","fetchLatestAnnouncement","info","openDialog","type","row","submitForm","put","post","success","msg","submitUpdateForm","warning","deleteAnnouncement","confirm","confirmButtonText","cancelButtonText","then","delete","catch"],"sources":["D:/web_code/zxyf/test_vue/src/components/Announcement.vue"],"sourcesContent":["<template>\n  <el-card>\n    <template #header>\n      <div class=\"card-header\">\n        <span>公告管理</span>\n        <el-button type=\"primary\" @click=\"openDialog('add')\">新增公告</el-button>\n      </div>\n    </template>\n\n    <!-- 公告列表页面 -->\n    <template v-if=\"!isUpdatePage\">\n      <el-table :data=\"announcements\" style=\"width: 100%\">\n        <el-table-column prop=\"title\" label=\"标题\" width=\"180\" />\n        <el-table-column prop=\"content\" label=\"内容\" />\n        <el-table-column prop=\"createTime\" label=\"发布时间\" width=\"180\" />\n        <el-table-column label=\"操作\" width=\"150\">\n          <template #default=\"{ row }\">\n            <el-button size=\"small\" @click=\"openDialog('edit', row)\">编辑</el-button>\n            <el-button size=\"small\" type=\"danger\" @click=\"deleteAnnouncement(row)\">删除</el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n    </template>\n\n    <!-- 更新系统公告页面 -->\n    <template v-else>\n        <el-form :model=\"latestAnnouncementForm\" label-width=\"120px\">\n          <el-form-item label=\"最新公告标题\">\n            <el-input v-model=\"latestAnnouncementForm.title\"></el-input>\n          </el-form-item>\n          <el-form-item label=\"最新公告内容\">\n            <el-input v-model=\"latestAnnouncementForm.content\" type=\"textarea\" :rows=\"6\"></el-input>\n          </el-form-item>\n          <el-form-item>\n            <el-button type=\"primary\" @click=\"submitUpdateForm\">更新公告</el-button>\n          </el-form-item>\n        </el-form>\n    </template>\n\n    <el-dialog v-model=\"dialogVisible\" :title=\"dialogTitle\" width=\"600px\">\n      <el-form :model=\"form\" label-width=\"80px\">\n        <el-form-item label=\"标题\">\n          <el-input v-model=\"form.title\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"内容\">\n          <el-input v-model=\"form.content\" type=\"textarea\" :rows=\"4\"></el-input>\n        </el-form-item>\n      </el-form>\n      <template #footer>\n        <el-button @click=\"dialogVisible = false\">取消</el-button>\n        <el-button type=\"primary\" @click=\"submitForm\">保存</el-button>\n      </template>\n    </el-dialog>\n  </el-card>\n</template>\n\n<script setup>\nimport { ref, onMounted, computed } from 'vue';\nimport axios from 'axios';\nimport { ElMessage, ElMessageBox } from 'element-plus';\nimport dayjs from 'dayjs';\nimport { useRoute } from 'vue-router';\n\nconst announcements = ref([]);\nconst dialogVisible = ref(false);\nconst dialogTitle = ref('');\nconst form = ref({\n  id: null,\n  title: '',\n  content: ''\n});\nconst isEditing = ref(false);\n\nconst route = useRoute();\n\nconst isUpdatePage = computed(() => route.path === '/announcement/update');\nconst latestAnnouncementForm = ref({\n  id: null,\n  title: '',\n  content: ''\n});\n\nconst fetchAnnouncements = async () => {\n  try {\n    const res = await axios.get('/announcement');\n    if (res.data.code === 1) {\n      // 格式化时间\n      announcements.value = res.data.data.map(item => ({\n        ...item,\n        createTime: dayjs(item.createTime).format('YYYY-MM-DD HH:mm:ss')\n      }));\n    }\n  } catch (error) {\n    ElMessage.error('获取公告列表失败');\n    console.error(error);\n  }\n};\n\nconst fetchLatestAnnouncement = async () => {\n  try {\n    const res = await axios.get('/announcement/latest');\n    if (res.data.code === 1 && res.data.data) {\n      latestAnnouncementForm.value = res.data.data;\n    } else {\n      ElMessage.info('暂无系统公告可更新。');\n      latestAnnouncementForm.value = { id: null, title: '', content: '' };\n    }\n  } catch (error) {\n    ElMessage.error('获取最新公告失败');\n    console.error(error);\n  }\n};\n\nconst openDialog = (type, row = null) => {\n  if (type === 'add') {\n    dialogTitle.value = '新增公告';\n    form.value = { id: null, title: '', content: '' };\n    isEditing.value = false;\n  } else { // edit\n    dialogTitle.value = '编辑公告';\n    form.value = { ...row }; // 复制现有数据\n    isEditing.value = true;\n  }\n  dialogVisible.value = true;\n};\n\nconst submitForm = async () => {\n  try {\n    let res;\n    if (isEditing.value) {\n      res = await axios.put(`/announcement/${form.value.id}`, form.value);\n    } else {\n      res = await axios.post('/announcement', form.value);\n    }\n\n    if (res.data.code === 1) {\n      ElMessage.success(`${isEditing.value ? '更新' : '新增'}成功`);\n      dialogVisible.value = false;\n      fetchAnnouncements(); // 刷新列表\n    } else {\n      ElMessage.error(res.data.msg || `${isEditing.value ? '更新' : '新增'}失败`);\n    }\n  } catch (error) {\n    ElMessage.error(`${isEditing.value ? '更新' : '新增'}异常`);\n    console.error(error);\n  }\n};\n\nconst submitUpdateForm = async () => {\n  if (!latestAnnouncementForm.value.title || !latestAnnouncementForm.value.content) {\n    ElMessage.warning('标题和内容不能为空');\n    return;\n  }\n  try {\n    const res = await axios.put(`/announcement/${latestAnnouncementForm.value.id}`, latestAnnouncementForm.value);\n    if (res.data.code === 1) {\n      ElMessage.success('系统公告更新成功');\n    } else {\n      ElMessage.error(res.data.msg || '系统公告更新失败');\n    }\n  } catch (error) {\n    ElMessage.error('更新系统公告异常');\n    console.error(error);\n  }\n};\n\nconst deleteAnnouncement = async (row) => {\n  ElMessageBox.confirm(`确定删除公告 \"${row.title}\" 吗?`, '提示', {\n    confirmButtonText: '确定',\n    cancelButtonText: '取消',\n    type: 'warning',\n  }).then(async () => {\n    try {\n      const res = await axios.delete(`/announcement/${row.id}`);\n      if (res.data.code === 1) {\n        ElMessage.success('删除成功');\n        fetchAnnouncements(); // 刷新列表\n      } else {\n        ElMessage.error(res.data.msg || '删除失败');\n      }\n    } catch (error) {\n      ElMessage.error('删除异常');\n      console.error(error);\n    }\n  }).catch(() => {\n    ElMessage.info('已取消删除');\n  });\n};\n\nonMounted(() => {\n  if (isUpdatePage.value) {\n    fetchLatestAnnouncement();\n  } else {\n    fetchAnnouncements();\n  }\n});\n</script>\n\n<style scoped>\n.card-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}